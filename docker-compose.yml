version: '3.8'

services:
  # PagerDuty MCP Server - Read-only mode (default)
  pagerduty-mcp-readonly:
    build:
      context: .
      dockerfile: Dockerfile
    image: pagerduty-mcp:latest
    container_name: pagerduty-mcp-readonly
    environment:
      # Required: PagerDuty API credentials
      - PAGERDUTY_USER_API_KEY=${PAGERDUTY_USER_API_KEY:?PAGERDUTY_USER_API_KEY environment variable is required}
      # Optional: Override default API host (for EU region)
      - PAGERDUTY_API_HOST=${PAGERDUTY_API_HOST:-https://api.pagerduty.com}
    # Read-only mode - no command arguments needed
    stdin_open: true
    tty: true
    profiles:
      - readonly

  # PagerDuty MCP Server - Write-enabled mode (use with caution)
  pagerduty-mcp-write:
    build:
      context: .
      dockerfile: Dockerfile
    image: pagerduty-mcp:latest
    container_name: pagerduty-mcp-write
    environment:
      # Required: PagerDuty API credentials
      - PAGERDUTY_USER_API_KEY=${PAGERDUTY_USER_API_KEY:?PAGERDUTY_USER_API_KEY environment variable is required}
      # Optional: Override default API host (for EU region)
      - PAGERDUTY_API_HOST=${PAGERDUTY_API_HOST:-https://api.pagerduty.com}
    # Enable write tools (CAUTION: Can modify PagerDuty account)
    command: ["--enable-write-tools"]
    stdin_open: true
    tty: true
    profiles:
      - write

# Usage:
# ------
# 1. Set environment variables:
#    export PAGERDUTY_USER_API_KEY=your_api_key
#    export PAGERDUTY_API_HOST=https://api.pagerduty.com  # Optional
#
# 2. Build the image:
#    docker-compose build
#
# 3. Run in read-only mode:
#    docker-compose --profile readonly up
#
# 4. Run in write mode (use with caution):
#    docker-compose --profile write up
#
# 5. Run interactively:
#    docker-compose --profile readonly run --rm pagerduty-mcp-readonly
#
# 6. Test with specific input:
#    echo '{"method":"tools/list"}' | docker-compose --profile readonly run --rm pagerduty-mcp-readonly
